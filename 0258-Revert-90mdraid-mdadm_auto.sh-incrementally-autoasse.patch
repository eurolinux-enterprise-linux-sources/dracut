From c99fbb55e402a766b387c13155409d0fe8b162c0 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 27 Jan 2012 14:59:42 +0100
Subject: [PATCH] Revert "90mdraid/mdadm_auto.sh: incrementally autoassemble"

This reverts commit 6b086476498d203494777ca66720f6f813cf77e1.
---
 modules.d/90mdraid/mdadm_auto.sh   | 2 +-
 modules.d/90mdraid/mdraid_start.sh | 9 ++++-----
 2 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/modules.d/90mdraid/mdadm_auto.sh b/modules.d/90mdraid/mdadm_auto.sh
index 52e8fce..a971a5a 100755
--- a/modules.d/90mdraid/mdadm_auto.sh
+++ b/modules.d/90mdraid/mdadm_auto.sh
@@ -2,4 +2,4 @@
 . /lib/dracut-lib.sh
 
 info "Autoassembling MD Raid"    
-/sbin/mdadm -As --auto=yes 2>&1 | vinfo
+/sbin/mdadm -As --auto=yes --run 2>&1 | vinfo
diff --git a/modules.d/90mdraid/mdraid_start.sh b/modules.d/90mdraid/mdraid_start.sh
index 6499c4c..4f6f929 100755
--- a/modules.d/90mdraid/mdraid_start.sh
+++ b/modules.d/90mdraid/mdraid_start.sh
@@ -1,14 +1,12 @@
 #!/bin/sh
 
 . /lib/dracut-lib.sh
-udevadm control --stop-exec-queue
-
 # run mdadm if udev has settled
-info "Autoassembling MD Raid"    
-/sbin/mdadm -As --auto=yes 2>&1 | vinfo
-
 info "Assembling MD RAID arrays"
+udevadm control --stop-exec-queue
 mdadm -IRs 2>&1 | vinfo
+info "Autoassembling MD Raid"    
+/sbin/mdadm -As --auto=yes --run 2>&1 | vinfo
 
 # there could still be some leftover devices
 # which have had a container added
@@ -21,6 +19,7 @@ for md in /dev/md[0-9]* /dev/md/*; do
 	mdadm -R "$md" 2>&1 | vinfo
 done
 
+
 ln -s /sbin/mdraid-cleanup /pre-pivot/30-mdraid-cleanup.sh 2>/dev/null
 ln -s /sbin/mdraid-cleanup /pre-pivot/31-mdraid-cleanup.sh 2>/dev/null
 udevadm control --start-exec-queue
