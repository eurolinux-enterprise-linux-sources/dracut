From 108d50e915c82943ee3d41578bff7564b122deed Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 20 Sep 2011 16:59:09 +0200
Subject: [PATCH] mdraid+lvm: order timeout queue execution

---
 modules.d/90lvm/64-lvm.rules                    | 2 +-
 modules.d/90mdraid/65-md-incremental-imsm.rules | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/modules.d/90lvm/64-lvm.rules b/modules.d/90lvm/64-lvm.rules
index 3bd46f4..49d5e73 100644
--- a/modules.d/90lvm/64-lvm.rules
+++ b/modules.d/90lvm/64-lvm.rules
@@ -14,7 +14,7 @@ PROGRAM=="/bin/sh -c 'for i in $sys/$devpath/holders/dm-[0-9]*; do [ -e $$i ] &&
     GOTO="lvm_end"
 
 RUN+="/sbin/initqueue --settled --onetime --unique /sbin/lvm_scan"
-RUN+="/sbin/initqueue --timeout --onetime --unique /sbin/lvm_scan --partial"
+RUN+="/sbin/initqueue --timeout --onetime --unique --name 51-lvm_scan /sbin/lvm_scan --partial"
 RUN+="/bin/sh -c '>/tmp/.lvm_scan-%k;'"
 
 LABEL="lvm_end"
diff --git a/modules.d/90mdraid/65-md-incremental-imsm.rules b/modules.d/90mdraid/65-md-incremental-imsm.rules
index 2548e14..06c5761 100644
--- a/modules.d/90mdraid/65-md-incremental-imsm.rules
+++ b/modules.d/90mdraid/65-md-incremental-imsm.rules
@@ -51,7 +51,7 @@ LABEL="do_raidstart"
 # check if array is not inactive anymore
 TEST=="md/array_state", ATTR{md/array_state}!="|inactive", GOTO="end_raidstart"
 
-RUN+="/bin/sh -c 'ln -s /sbin/md_finished.sh /initqueue-finished/md_finished.sh;/sbin/initqueue --timeout --onetime --unique /sbin/mdraid_start'"
+RUN+="/bin/sh -c 'ln -s /sbin/md_finished.sh /initqueue-finished/md_finished.sh;/sbin/initqueue --timeout --onetime --name 51-mdraid_start --unique /sbin/mdraid_start'"
 
 LABEL="end_raidstart"
 
@@ -70,6 +70,6 @@ GOTO="end_container"
 
 LABEL="do_container"
 
-RUN+="/bin/sh -c 'ln -s /sbin/md_finished.sh /initqueue-finished/md_finished.sh;/sbin/initqueue --timeout --onetime --unique --name mdcontainer_start-%k /sbin/mdcontainer_start $env{DEVNAME}'"
+RUN+="/bin/sh -c 'ln -s /sbin/md_finished.sh /initqueue-finished/md_finished.sh;/sbin/initqueue --timeout --onetime --name 50-mdcontainer_start --unique --name mdcontainer_start-%k /sbin/mdcontainer_start $env{DEVNAME}'"
 
 LABEL="end_container"
