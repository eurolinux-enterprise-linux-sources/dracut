From cf729a109dd6d42478deb0354af78f14509b9f1e Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Mon, 11 May 2015 17:03:07 +0200
Subject: [PATCH] lvm: install all lvm_*.conf files from /etc/lvm

https://bugzilla.redhat.com/show_bug.cgi?id=1130565
---
 modules.d/90lvm/install | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/modules.d/90lvm/install b/modules.d/90lvm/install
index 6b507be..a45dcec 100755
--- a/modules.d/90lvm/install
+++ b/modules.d/90lvm/install
@@ -3,13 +3,18 @@ inst lvm
 
 inst_rules "$moddir/64-lvm.rules" 64-lvm.rules
 
-if [[ $hostonly ]] || [[ $lvmconf = "yes" ]]; then 
+if [[ $hostonly ]] || [[ $lvmconf = "yes" ]]; then
     if [ -f /etc/lvm/lvm.conf ]; then
-	inst /etc/lvm/lvm.conf
-	[ -f /etc/lvm/lvm_hostname.conf ] && inst /etc/lvm/lvm_hostname.conf
-	# FIXME: near-term hack to establish read-only locking;
-	# use command-line lvm.conf editor once it is available
-	sed -i -e 's/\(^[[:space:]]*\)locking_type[[:space:]]*=[[:space:]]*[[:digit:]]/\1locking_type = 4/' ${initdir}/etc/lvm/lvm.conf
+        for f in /etc/lvm/lvm.conf /etc/lvm/lvm_*.conf; do
+	    [ -e "$f" ] || continue
+            inst "$f"
+	    # FIXME: near-term hack to establish read-only locking;
+	    # use command-line lvm.conf editor once it is available
+	    [ -f "${initdir}/$f" ] && \
+                sed -i -e \
+                    's/\(^[[:space:]]*\)locking_type[[:space:]]*=[[:space:]]*[[:digit:]]/\1locking_type = 4/' \
+                    "${initdir}/$f"
+        done
     fi
 fi
 
@@ -18,7 +23,6 @@ inst_rules 11-dm-lvm.rules
 inst "$moddir/lvm_scan.sh" /sbin/lvm_scan
 inst_hook cmdline 30 "$moddir/parse-lvm.sh"
 
-
 if ldd $(which lvm) 2>/dev/null | grep -q lib64; then
     LIBDIR="/lib64"
 else
