From b490820a6794991e389890c9b174e562453d72d8 Mon Sep 17 00:00:00 2001
From: Chad Dupuis <chad.dupuis@cavium.com>
Date: Wed, 12 Oct 2016 11:32:47 -0400
Subject: [PATCH] fcoe: Allow more time for the bnx2x link negotiation before
 brining up fcoe interfaces.

bnx2x can take no longer than 3 seconds to initialize the link in some setups
which can cause fipvlan to fail and thus the fcoe interface(s) won't be
created.

Add another 10 seconds to give the link enough time to initialize.

Signed-off-by: Chad Dupuis <chad.dupuis@cavium.com>

Cherry-picked from: 3966a1e1ee0e3d27197258f446f54b683c415208
Resolves: #1482185
---
 modules.d/95fcoe/fcoe-up | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/modules.d/95fcoe/fcoe-up b/modules.d/95fcoe/fcoe-up
index 6b856fb..31f082d 100755
--- a/modules.d/95fcoe/fcoe-up
+++ b/modules.d/95fcoe/fcoe-up
@@ -41,7 +41,7 @@ elif [ "$netdriver" = "bnx2x" ] || getarg 'autovlan=yes'; then
     modprobe 8021q
     udevadm settle --timeout=30 >/dev/null 2>&1
     # Sleep for 3 s to allow dcb negotiation
-    sleep 3
+    sleep 13
     fipvlan "$netif" -c -s --link-retry=100 -f "-fcoe"
 else
     echo -n "$netif" > /sys/module/fcoe/parameters/create
