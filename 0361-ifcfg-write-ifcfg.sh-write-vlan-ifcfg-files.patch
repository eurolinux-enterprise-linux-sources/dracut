From 2822eb855affb17c04e723262589401d4798167a Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 3 Mar 2015 09:57:30 +0100
Subject: [PATCH] ifcfg/write-ifcfg.sh: write vlan ifcfg files

https://bugzilla.redhat.com/show_bug.cgi?id=1111358
---
 modules.d/45ifcfg/write-ifcfg.sh | 20 +++++++++++++++++++-
 1 file changed, 19 insertions(+), 1 deletion(-)

diff --git a/modules.d/45ifcfg/write-ifcfg.sh b/modules.d/45ifcfg/write-ifcfg.sh
index a3a980b..3d4b7be 100644
--- a/modules.d/45ifcfg/write-ifcfg.sh
+++ b/modules.d/45ifcfg/write-ifcfg.sh
@@ -17,18 +17,27 @@ if [ -e /tmp/bridge.info ]; then
     . /tmp/bridge.info
 fi
 
+if [ -e /tmp/vlan.info ]; then
+    . /tmp/vlan.info
+fi
+
 mkdir -p /tmp/ifcfg/
 
 for netif in $IFACES ; do
     # bridge?
     unset bridge
     unset bond
+    unset vlan
+
     if [ "$netif" = "$bridgename" ]; then
         bridge=yes
     elif [ "$netif" = "$bondname" ]; then
     # $netif can't be bridge and bond at the same time
         bond=yes
     fi
+    if [ "$netif" = "$vlanname" ]; then
+        vlan=yes
+    fi
     cat /sys/class/net/$netif/address > /tmp/net.$netif.hwaddr
     {
         echo "# Generated by dracut initrd"
@@ -50,7 +59,7 @@ for netif in $IFACES ; do
     } > /tmp/ifcfg/ifcfg-$netif
 
     # bridge needs different things written to ifcfg
-    if [ -z "$bridge" ] && [ -z "$bond" ]; then
+    if [ -z "$bridge" ] && [ -z "$bond" ] && [ -z "$vlan" ]; then
         # standard interface
         {
             echo "HWADDR=$(cat /sys/class/net/$netif/address)"
@@ -59,6 +68,15 @@ for netif in $IFACES ; do
         } >> /tmp/ifcfg/ifcfg-$netif
     fi
 
+    if [ -n "$vlan" ] ; then
+        {
+            echo "TYPE=Vlan"
+            echo "NAME=\"$netif\""
+            echo "VLAN=yes"
+            echo "PHYSDEV=\"$phydevice\""
+        } >> /tmp/ifcfg/ifcfg-$netif
+    fi
+
     if [ -n "$bond" ] ; then
         # bond interface
         {
