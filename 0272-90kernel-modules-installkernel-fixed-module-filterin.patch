From 6410b72af65366332e16dfd5b06e93f8a348012a Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Mon, 5 Mar 2012 12:31:11 +0100
Subject: [PATCH] 90kernel-modules/installkernel: fixed module filtering

---
 modules.d/90kernel-modules/installkernel | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/modules.d/90kernel-modules/installkernel b/modules.d/90kernel-modules/installkernel
index cd51786..e697e0f 100755
--- a/modules.d/90kernel-modules/installkernel
+++ b/modules.d/90kernel-modules/installkernel
@@ -17,7 +17,10 @@ if [[ -z $drivers ]]; then
     # if not on hostonly mode, install all known filesystems if the required list is not set via the filesystems variable
     if ! [[ $hostonly ]]; then
 	if [[ -z $filesystems ]]; then
-	    omit_drivers="$omit_drivers|.*/fs/ocfs/.*" instmods '=fs'
+	    n_omit_drivers=".*/fs/ocfs/.*|$omit_drivers"
+	    n_omit_drivers=${n_omit_drivers%%|}
+	    omit_drivers="$n_omit_drivers" instmods '=fs'
+	    unset n_omit_drivers
 	    # hardcoded list of exceptions
 	    # to save a lot of space
 	    rm -fr ${initdir}/lib/modules/*/kernel/fs/ocfs2
