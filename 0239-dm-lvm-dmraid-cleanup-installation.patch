From 6794a14d78af1d20d9ca40d6eeed91bb7b5db675 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 20 Sep 2011 17:49:50 +0200
Subject: [PATCH] dm/lvm/dmraid: cleanup installation

---
 modules.d/90dm/install     |  4 ++--
 modules.d/90dmraid/install | 10 ++++++++++
 modules.d/90lvm/install    |  2 +-
 3 files changed, 13 insertions(+), 3 deletions(-)

diff --git a/modules.d/90dm/install b/modules.d/90dm/install
index 2eb732e..a1948b6 100755
--- a/modules.d/90dm/install
+++ b/modules.d/90dm/install
@@ -13,8 +13,8 @@ else
     LIBDIR="/lib"
 fi
 
-for i in $(ls /{usr,}/$LIBDIR/libdmraid-events*.so 2>/dev/null); do
+for i in $(ls /{usr,}/$LIBDIR/libdevmapper-event.so* 2>/dev/null); do
     dracut_install $i
 done
 
-inst_rules 10-dm.rules 95-dm-notify.rules
+inst_rules 10-dm.rules 13-dm-disk.rules 95-dm-notify.rules
diff --git a/modules.d/90dmraid/install b/modules.d/90dmraid/install
index 679d9cf..17b4226 100755
--- a/modules.d/90dmraid/install
+++ b/modules.d/90dmraid/install
@@ -3,6 +3,16 @@ dracut_install dmraid partx kpartx
 
 inst  dmeventd
 
+if ldd $(which dmraid) | grep -q lib64; then
+    LIBDIR="/lib64"
+else
+    LIBDIR="/lib"
+fi
+
+for i in $(ls /{usr,}/$LIBDIR/libdmraid-events*.so 2>/dev/null); do
+    dracut_install $i
+done
+
 inst_rules 13-dm-disk.rules
 
 inst "$moddir/dmraid.sh" /sbin/dmraid_scan
diff --git a/modules.d/90lvm/install b/modules.d/90lvm/install
index 0813486..2339770 100755
--- a/modules.d/90lvm/install
+++ b/modules.d/90lvm/install
@@ -12,7 +12,7 @@ if [[ $hostonly ]] || [[ $lvmconf = "yes" ]]; then
     fi
 fi
 
-inst_rules 10-dm.rules 13-dm-disk.rules 95-dm-notify.rules 11-dm-lvm.rules
+inst_rules 11-dm-lvm.rules
 
 inst "$moddir/lvm_scan.sh" /sbin/lvm_scan
 inst_hook cmdline 30 "$moddir/parse-lvm.sh"
