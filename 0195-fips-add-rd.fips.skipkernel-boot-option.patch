From 412ff7139b8c356dfa472acaf267940f4b054bb0 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Wed, 6 Apr 2011 11:32:24 +0200
Subject: [PATCH] fips: add "rd.fips.skipkernel" boot option

---
 modules.d/01fips/fips.sh | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/modules.d/01fips/fips.sh b/modules.d/01fips/fips.sh
index 02e370f..66bb28e 100755
--- a/modules.d/01fips/fips.sh
+++ b/modules.d/01fips/fips.sh
@@ -1,7 +1,7 @@
 #!/bin/sh
-do_fips()
+
+do_fipskernel()
 {
-    FIPSMODULES=$(cat /etc/fipsmodules)
     boot=$(getarg boot=)
     KERNEL=$(uname -r)
     case "$boot" in
@@ -46,7 +46,15 @@ do_fips()
 
     info "Umounting /boot"
     umount /boot
+}
 
+do_fips()
+{
+    FIPSMODULES=$(cat /etc/fipsmodules)
+
+    if ! getarg rd.fips.skipkernel >/dev/null; then
+	do_fipskernel
+    fi
     info "Loading and integrity checking all crypto modules"
     for module in $FIPSMODULES; do
         if [ "$module" != "tcrypt" ]; then
