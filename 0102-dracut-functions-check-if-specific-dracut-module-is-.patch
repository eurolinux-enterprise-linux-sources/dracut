From 60953678c298cdaf31f724d87aeb3dec8303cea4 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Wed, 26 May 2010 17:42:57 +0200
Subject: [PATCH] dracut-functions: check if specific dracut module is missing

---
 dracut-functions | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/dracut-functions b/dracut-functions
index 5162d3d..c8ac6de 100755
--- a/dracut-functions
+++ b/dracut-functions
@@ -390,6 +390,8 @@ should_source_module() {
 }
 
 check_modules() {
+    local modcheck;
+    local mod;
     for moddir in "$dracutbasedir/modules.d"/[0-9][0-9]*; do
 	local mod=${moddir##*/}; mod=${mod#[0-9][0-9]}
 	# If we are already scheduled to be loaded, no need to check again.
@@ -404,6 +406,14 @@ check_modules() {
         fi
 	mods_to_load+=" $mod "
     done
+
+    modcheck=$add_dracutmodules
+    [[ $dracutmodules != all ]] && modcheck="$m $dracutmodules"
+    for mod in $modcheck; do
+        strstr "$mods_to_load" "$mod" && continue
+        strstr "$omit_dracutmodules" "$mod" && continue
+        dwarning "Dracut module \"$mod\" cannot be found."
+    done
 }
 
 # Install a single kernel module along with any firmware it may require.
