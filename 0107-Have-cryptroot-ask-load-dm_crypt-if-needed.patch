From 3eb019d36b0ba363a65bc876ae800fc7e0839ed5 Mon Sep 17 00:00:00 2001
From: Victor Lowther <victor.lowther@gmail.com>
Date: Wed, 2 Jun 2010 07:07:55 -0500
Subject: [PATCH] Have cryptroot-ask load dm_crypt if needed.

---
 modules.d/90crypt/cryptroot-ask.sh | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/modules.d/90crypt/cryptroot-ask.sh b/modules.d/90crypt/cryptroot-ask.sh
index 2f39667..430155a 100755
--- a/modules.d/90crypt/cryptroot-ask.sh
+++ b/modules.d/90crypt/cryptroot-ask.sh
@@ -9,6 +9,9 @@
 # we already asked for this device
 [ -f /tmp/cryptroot-asked-$2 ] && exit 0
 
+# load dm_crypt if it is not already loaded
+[ -d /sys/module/dm_crypt ] || modprobe dm_crypt
+
 . /lib/dracut-lib.sh
 
 # default luksname - luks-UUID
