From 810270eb0012683068cab8cc44db0268be0994c3 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 20 Jul 2010 11:23:14 +0200
Subject: [PATCH] multipath: install by default, but run only if wwids are
 present

---
 modules.d/90multipath/check         | 12 +++++++-----
 modules.d/90multipath/multipathd.sh |  2 +-
 2 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/modules.d/90multipath/check b/modules.d/90multipath/check
index cae2052..b1834b5 100755
--- a/modules.d/90multipath/check
+++ b/modules.d/90multipath/check
@@ -14,10 +14,12 @@ is_mpath() {
     return 1
 }
 
-# Do mpath if we appear to be using it for /
-rootdev=$(find_root_block_device)
-if [[ $rootdev ]]; then
-    check_block_and_slaves is_mpath "$rootdev" && exit 0
+if [[ $1 = -h ]]; then
+    rootdev=$(find_root_block_device)
+    if [[ $rootdev ]]; then
+        check_block_and_slaves is_mpath "$rootdev" && exit 0
+    fi
+    exit 1
 fi
 
-exit 1
+exit 0
\ No newline at end of file
diff --git a/modules.d/90multipath/multipathd.sh b/modules.d/90multipath/multipathd.sh
index e26ab84..c9a2b3f 100755
--- a/modules.d/90multipath/multipathd.sh
+++ b/modules.d/90multipath/multipathd.sh
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-if [ -e /etc/multipath.conf ]; then
+if [ -e /etc/multipath.conf -a -e /etc/multipath/wwids ]; then
     modprobe dm-multipath
     multipathd
 else
