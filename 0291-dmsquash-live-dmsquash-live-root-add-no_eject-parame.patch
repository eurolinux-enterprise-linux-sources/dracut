From 00056957bfa8f8f8fb1fee60859668ddaf927f50 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 11 Oct 2012 13:45:35 +0200
Subject: [PATCH] dmsquash-live/dmsquash-live-root: add "no_eject" parameter

https://bugzilla.redhat.com/show_bug.cgi?id=843105
---
 modules.d/90dmsquash-live/dmsquash-live-root | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/modules.d/90dmsquash-live/dmsquash-live-root b/modules.d/90dmsquash-live/dmsquash-live-root
index 38c4819..944f827 100755
--- a/modules.d/90dmsquash-live/dmsquash-live-root
+++ b/modules.d/90dmsquash-live/dmsquash-live-root
@@ -19,6 +19,7 @@ livedev="$1"
 live_dir=$(getarg live_dir)
 [ -z "$live_dir" ] && live_dir="LiveOS"
 getarg live_ram && live_ram="yes"
+getarg no_eject && no_eject="yes"
 getarg reset_overlay && reset_overlay="yes"
 getarg readonly_overlay && readonly_overlay="--readonly" || readonly_overlay=""
 overlay=$(getarg overlay)
@@ -146,7 +147,9 @@ if [ -e "$SQUASHED" ] ; then
         dd if=$SQUASHED of=/squashed.img bs=512 2> /dev/null
         umount -n /dev/.initramfs/live
         echo "Done copying live image to RAM."
-        eject -p $livedev || :
+        if [ ! -n "$no_eject" ]; then
+            eject -p $livedev || :
+        fi
         SQUASHED="/squashed.img"
     fi
 
