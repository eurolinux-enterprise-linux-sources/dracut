From ac607d92dc2cd26c8752728a9c4e957f02d032cd Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 19 Jan 2016 19:45:32 +0100
Subject: [PATCH] wait_for_if_up(): check for <UP> rather than "state UP"

or LOWER_UP if "state UNKNOWN" or "state DORMANT"
---
 modules.d/99base/dracut-lib.sh | 16 +++++++++++++++-
 1 file changed, 15 insertions(+), 1 deletion(-)

diff --git a/modules.d/99base/dracut-lib.sh b/modules.d/99base/dracut-lib.sh
index 2a8e12e..5ce329c 100644
--- a/modules.d/99base/dracut-lib.sh
+++ b/modules.d/99base/dracut-lib.sh
@@ -203,7 +203,21 @@ wait_for_if_up() {
     local cnt=0
     while [ $cnt -lt 100 ]; do 
 	li=$(ip link show $1)
-	[ -z "${li##*state UP*}" ] && return 0
+        if [ -n "$li" ]; then
+            case "$li" in
+                *\<UP*)
+                    return 0;;
+                *\<*,UP\>*)
+                    return 0;;
+                *\<*,UP,*\>*)
+                    return 0;;
+            esac
+        fi
+        if strstr "$li" "LOWER_UP" \
+                && strstr "$li" "state UNKNOWN" \
+                && ! strstr "$li" "DORMANT"; then
+            return 0
+        fi
 	sleep 0.1
 	cnt=$(($cnt+1))
     done 
