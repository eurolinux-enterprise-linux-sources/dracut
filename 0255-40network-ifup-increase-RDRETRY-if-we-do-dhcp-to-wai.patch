From 76766f9fabac64b6d4f543a411f2fb4520d74834 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 4 Nov 2011 16:12:17 +0100
Subject: [PATCH] 40network/ifup: increase RDRETRY, if we do dhcp to wait
 longer

https://bugzilla.redhat.com/show_bug.cgi?id=742920
---
 modules.d/40network/ifup | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/modules.d/40network/ifup b/modules.d/40network/ifup
index 7783263..9eab3b4 100755
--- a/modules.d/40network/ifup
+++ b/modules.d/40network/ifup
@@ -14,6 +14,10 @@ do_dhcp() {
     # XXX add -V vendor class and option parsing per kernel
     #echo "Starting dhcp for interface $netif"
     dhclient "$@" -1 -q -cf /etc/dhclient.conf -pf /tmp/dhclient.$netif.pid -lf /tmp/dhclient.$netif.lease $netif &
+
+    # increase wait time for DHCP
+    echo '[ $(($RDRETRY-$main_loop)) -lt 720 ] && RDRETRY=$(($main_loop+720)); rm -f "$job"' > /initqueue/rd_retry_inc_dhclient.$netif.sh
+
     #|| echo "dhcp failed"
 }
 
