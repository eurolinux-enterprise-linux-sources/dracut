From 4ac0cbad25f42b57fc082f89af5da7ba3355eb20 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Wed, 30 Mar 2011 14:50:42 +0200
Subject: [PATCH] fips: fixed "boot=<dev>" handling

---
 modules.d/01fips/fips.sh | 18 ++++++++----------
 1 file changed, 8 insertions(+), 10 deletions(-)

diff --git a/modules.d/01fips/fips.sh b/modules.d/01fips/fips.sh
index c42159e..02e370f 100755
--- a/modules.d/01fips/fips.sh
+++ b/modules.d/01fips/fips.sh
@@ -2,26 +2,24 @@
 do_fips()
 {
     FIPSMODULES=$(cat /etc/fipsmodules)
-    BOOT=$(getarg boot=)
+    boot=$(getarg boot=)
     KERNEL=$(uname -r)
     case "$boot" in
-    block:LABEL=*|LABEL=*)
-        boot="${boot#block:}"
+    LABEL=*)
         boot="$(echo $boot | sed 's,/,\\x2f,g')"
         boot="/dev/disk/by-label/${boot#LABEL=}"
-        bootok=1 ;;
-    block:UUID=*|UUID=*)
-        boot="${boot#block:}"
-        boot="/dev/disk/by-uuid/${root#UUID=}"
-        bootok=1 ;;
+        ;;
+    UUID=*)
+        boot="/dev/disk/by-uuid/${boot#UUID=}"
+        ;;
     /dev/*)
-        bootok=1 ;;
+        ;;
     *)
         die "You have to specify boot=<boot device> as a boot option for fips=1" ;;
     esac
 
     if ! [ -e "$boot" ]; then
-        udevadm trigger >/dev/null 2>&1
+        udevadm trigger --action=add >/dev/null 2>&1
         [ -z "$UDEVVERSION" ] && UDEVVERSION=$(udevadm --version)
 
         if [ $UDEVVERSION -ge 143 ]; then
