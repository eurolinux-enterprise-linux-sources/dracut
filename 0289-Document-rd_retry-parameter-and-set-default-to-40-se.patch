From 019b3f0277f2e6e3ac759c1ed0b25cdc460f51a6 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 11 Oct 2012 13:28:50 +0200
Subject: [PATCH] Document "rd_retry" parameter and set default to 40 seconds.

https://bugzilla.redhat.com/show_bug.cgi?id=823507
---
 dracut.8              | 11 ++++++++---
 modules.d/99base/init |  2 +-
 2 files changed, 9 insertions(+), 4 deletions(-)

diff --git a/dracut.8 b/dracut.8
index a380203..9fcc55b 100644
--- a/dracut.8
+++ b/dracut.8
@@ -132,7 +132,7 @@ specify blockdevice to use as root filesystem.
 .BR rootfstype= "<filesystem type>"
 "auto" if not specified, e.g. rootfstype=ext3
 .TP
-.BR rootflags "=<mount options>"
+.BR rootflags= "<mount options>"
 specify additional mount options for the root filesystem. If not set, /etc/fstab
 of the real root will be parsed for special mount options and mounted 
 accordingly.
@@ -143,13 +143,18 @@ do not honor special mount options for the root filesystem found in
 
 .SS Misc
 .TP
-.BR rdblacklist= <drivername>
+.BR rdblacklist= "<drivername>"
 do not load kernel module <drivername>
 This parameter can be specified multiple times.
 .TP
-.BR rdloaddriver= <drivername>
+.BR rdloaddriver= "<drivername>"
 force loading kernel module <drivername>
 This parameter can be specified multiple times.
+.TP
+.BR rd_retry= "<seconds>"
+wait <seconds> until dracut tries to force assemble LVM or RAID volumes. If the root device is not found within <seconds>*2 then dracut fails and either drops to a shell, if rdshell is on the kernel command line, or exits with 1, which normally causes a kernel panic.
+
+Default: rd_retry=40
 
 .SS Debug
 .TP
diff --git a/modules.d/99base/init b/modules.d/99base/init
index f938eb3..b352b1f 100755
--- a/modules.d/99base/init
+++ b/modules.d/99base/init
@@ -156,7 +156,7 @@ udevadm trigger --action=add $udevtriggeropts  >/dev/null 2>&1
 getarg 'rdbreak=initqueue' && emergency_shell -n initqueue "Break before initqueue"
 
 RDRETRY=$(getarg 'rd_retry=')
-RDRETRY=${RDRETRY:-20}
+RDRETRY=${RDRETRY:-40}
 RDRETRY=$(($RDRETRY*2))
 export RDRETRY
 main_loop=0
